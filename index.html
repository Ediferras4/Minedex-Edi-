<!-- DEX COMPLETA PRONTA PARA COLAR -->
<html>
<head>
  <meta charset="UTF-8">
  <title>Mini DEX</title>
  <style>
    body { font-family: Arial; background:#0b0f12; color:white; margin:20px; }
    .container { max-width:420px; margin:auto; padding:20px; background:#11161b; border-radius:12px; }
    .btn-primary { background:#3b82f6; color:white; padding:10px; border:none; border-radius:8px; cursor:pointer; }
    .theme-toggle { background:#4b5563; color:white; padding:10px; border:none; border-radius:8px; cursor:pointer; }
    #swapModal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); }
    #swapModal.open { display:flex; justify-content:center; align-items:center; }
    #swapModal .modal-box { background:#11161b; padding:20px; width:330px; border-radius:12px; }
  </style>
</head>
<body>
<div class="container">
    <h2>Mini DEX</h2>

    <button id="themeBtn" class="theme-toggle">Modo Claro</button>

    <h3 id="networkBadge">ARC TESTNET</h3>

    <button id="connectBtn" class="btn-primary">Conectar Wallet</button>
    <div id="addrDisplay">Carteira: —</div>

    <button id="openSwap" class="btn-primary" style="margin-top:20px">Abrir Swap</button>
    <button id="toggleIcons" class="theme-toggle" style="margin-top:10px">Alternar Ícones</button>
</div>

<!-- Modal Swap -->
<div id="swapModal">
  <div class="modal-box">
    <h3>Swap</h3>
    <div class="small muted">Troca visual — sem transação real</div>

    <label>De</label>
    <select id="fromToken">
      <option value="ARC">ARC</option>
      <option value="tUSDC">tUSDC</option>
      <option value="tETH">tETH</option>
    </select>

    <label>Para</label>
    <select id="toToken">
      <option value="tUSDC">tUSDC</option>
      <option value="ARC">ARC</option>
      <option value="tETH">tETH</option>
    </select>

    <label>Quantidade</label>
    <input id="swapAmount" type="number" min="0" step="0.0001" placeholder="Quantidade">

    <div style="display:flex;gap:8px;margin-top:10px">
      <button class="btn-primary" id="doSwap">Confirmar Swap</button>
      <button class="theme-toggle" id="closeSwap">Fechar</button>
    </div>

    <div class="swap-result" id="swapResult">Nenhuma operação realizada.</div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/ethers/dist/ethers.min.js"></script>
<script>
/* ===== Configurações ARC Testnet ===== */
const ARC_TEST = {
  chainIdHex: "0x4cef52", // 5042002
  chainName: "Arc Testnet",
  rpcUrls: ["https://rpc.testnet.arc.network"],
  nativeCurrency: { name: "USDC", symbol: "USDC", decimals: 6 },
  blockExplorerUrls: ["https://testnet.arcscan.app"]
};

/* ===== UI ===== */
const themeBtn = document.getElementById('themeBtn');
const connectBtn = document.getElementById('connectBtn');
const addrDisplay = document.getElementById('addrDisplay');
const openSwap = document.getElementById('openSwap');
const swapModal = document.getElementById('swapModal');
const closeSwap = document.getElementById('closeSwap');
const doSwap = document.getElementById('doSwap');
const swapResult = document.getElementById('swapResult');
const toggleIconsBtn = document.getElementById('toggleIcons');

let dark = true;

function applyTheme() {
  document.body.style.background = dark ? '#0b0f12' : '#f7f8fa';
  document.body.style.color = dark ? 'white' : '#102027';
}
applyTheme();

themeBtn.addEventListener('click', ()=>{
  dark = !dark;
  themeBtn.textContent = dark ? 'Modo Claro' : 'Modo Escuro';
  applyTheme();
});

toggleIconsBtn.addEventListener('click', ()=>{
  toggleIconsBtn.textContent = toggleIconsBtn.textContent.includes('Emojis') ? 'Alternar Ícones' : 'Ícones Emojis';
});

/* ===== Modal Swap ===== */
openSwap.addEventListener('click', ()=> swapModal.classList.add('open'));
closeSwap.addEventListener('click', ()=> swapModal.classList.remove('open'));

doSwap.addEventListener('click', ()=>{
  const from = document.getElementById('fromToken').value;
  const to = document.getElementById('toToken').value;
  const amt = Number(document.getElementById('swapAmount').value);

  if(!amt || amt <= 0) return swapResult.textContent = 'Digite uma quantidade válida.';
  if(from === to) return swapResult.textContent = 'Escolha tokens diferentes.';

  const received = amt * 0.997;
  swapResult.textContent = `Simulação: ${amt} ${from} → ~${received.toFixed(6)} ${to} (taxa 0.3%).`;
});

/* ===== Wallet ===== */
async function ensureArcNetwork(provider) {
  try {
    await provider.send("wallet_switchEthereumChain", [{ chainId: ARC_TEST.chainIdHex }]);
  } catch (switchError) {
    try {
      await provider.send("wallet_addEthereumChain", [{
        chainId: ARC_TEST.chainIdHex,
        chainName: ARC_TEST.chainName,
        rpcUrls: ARC_TEST.rpcUrls,
        nativeCurrency: ARC_TEST.nativeCurrency,
        blockExplorerUrls: ARC_TEST.blockExplorerUrls
      }]);
    } catch (err) {
      alert('Erro ao adicionar a rede.');
    }
  }
}

async function connectWallet() {
  if(!window.ethereum) return alert('MetaMask não detectado. Abra pelo navegador da carteira.');

  const provider = new ethers.providers.Web3Provider(window.ethereum, "any");

  try {
    await provider.send("eth_requestAccounts", []);
    const signer = provider.getSigner();
    const address = await signer.getAddress();

    addrDisplay.textContent = 'Carteira: ' + address.slice(0,6) + '...' + address.slice(-4);
    connectBtn.textContent = 'Conectado';

    await ensureArcNetwork(provider.provider);

  } catch (err) {
    alert('Erro ao conectar: ' + err.message);
  }
}
connectBtn.addEventListener('click', connectWallet);

/* Detectar mudança de conta */
if(window.ethereum){
  window.ethereum.on('accountsChanged', (acc)=>{
    addrDisplay.textContent = acc.length ? 'Carteira: ' + acc[0].slice(0,6) + '...' + acc[0].slice(-4) : 'Carteira: —';
  });
  window.ethereum.on('chainChanged', (id)=>{
    document.getElementById('networkBadge').textContent = id === ARC_TEST.chainIdHex ? 'ARC TESTNET' : 'Rede: ' + id;
  });
}

</script>
</body>
</html>

